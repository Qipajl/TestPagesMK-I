import{$ as l,a7 as u,a0 as p,a1 as q,a3 as m,_ as g,f as R,a4 as _,A as v,r as w,o as D,i as P,w as b,b as O,m as Y}from"./index-C2nmCatd.js";import{v as s}from"./validation-D2voD8Jn.js";function F({crudOptions:d}){return{crudOptions:{request:{transformQuery:({page:e,form:t,sort:r})=>{const o=r==null?{}:{orderProp:r.prop,orderAsc:r.asc};return{pageNum:e.currentPage,pageSize:e.pageSize,ordersBo:{...t},...o}},transformRes:({res:e})=>({total:e.total,records:e.rows}),pageRequest:async e=>await p("/orders/listPages",e),addRequest:async({form:e})=>{const r={orderId:(await m("/orders/add",e)).data,productId:e.productId,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice},o={productId:e.productId,stockQuantity:-e.quantity};return await p("/products/update",o),await m("/orderItems/add",r)},editRequest:async({form:e,row:t})=>(e.orderId=t.orderId,await p("/orders/addOrUpdate",e)),delRequest:async({row:e})=>{try{const t=await u("/orderItems/list"),r=t.data.map(a=>({orderId:a.orderId,quantity:a.quantity,productId:a.productId})),o=r.find(a=>a.orderId===e.orderId);console.log("匹配的订单项:",o,r,t),await q("/orders/delete",{id:e.orderId});const n={productId:o.productId,orderId:e.orderId,quantity:o.quantity};return await m("/returns/add",n)}catch(t){return console.error("删除失败:",t),null}}},pagination:{pageSize:10,pageNum:1},form:{watch({form:e}){e.totalPrice=e.quantity*e.unitPrice}},columns:{orderId:{column:{show:!1},title:"资产ID",key:"order_id",type:"number",form:{show:!1},viewForm:{show:!0}},customerId:{column:{minWidth:30,align:"center"},title:"部门名称",type:"dict-select",search:{show:!0},form:{rules:s.required},dict:l({value:"customerId",label:"customerName",url:"/customers/list",getData:async e=>{try{return(await u(e.url)).data}catch(t){return console.error("获取字典数据失败:",t),[]}}})},status:{title:"资产状态",type:"dict-select",form:{rules:s.required},dict:l({data:[{value:"使用中",label:"使用中"},{value:"损坏",label:"损坏"},{value:"备用",label:"备用"}]})},orderDate:{title:"审批日期",type:"date",form:{show:!0,rules:s.required,component:{valueFormat:"YYYY-MM-DD"},value:new Date().toISOString()}},createdAt:{title:"创建时间",type:"date",search:{title:"创建时间",show:!0,component:{type:"datetimerange"}},form:{show:!0,component:{valueFormat:"YYYY-MM-DD"},rules:s.required,value:new Date().toISOString()}},updatedAt:{title:"更新时间",type:"date",form:{show:!1}},productId:{column:{show:!1},type:"dict-select",form:{show:!1,rules:s.required,component:{on:{onChange:async({value:e,row:t,form:r})=>{if(r)try{const n=(await u("/products/list")).data.find(a=>a.productId===r.productId);n&&(r.unitPrice=n.unitPrice)}catch(o){console.error("获取商品数量失败:",o)}}}}},addForm:{title:"商品名称",show:!0},dict:l({value:"productId",label:"productName",url:"/products/list",getData:async e=>{try{return(await u(e.url)).data}catch(t){return console.error("获取字典数据失败:",t),[]}}})},quantity:{column:{show:!1},type:"number",form:{show:!1,rules:s.required},addForm:{title:"数量",show:!0}},unitPrice:{column:{show:!1},type:"number",form:{show:!1,rules:s.required},addForm:{title:"售价",show:!0}},totalPrice:{column:{show:!1},type:"number",form:{show:!1,readonly:!0,component:{disabled:!0}},addForm:{title:"总价",show:!0}}}}}}const S=R({name:"OrderCrud",setup(){const{crudRef:d,crudBinding:c,crudExpose:i}=_({createCrudOptions:F});return v(()=>{i.doRefresh()}),{crudBinding:c,crudRef:d}}});function C(d,c,i,y,I,h){const f=w("fs-crud"),e=w("fs-page");return D(),P(e,null,{default:b(()=>[O(f,Y({ref:"crudRef"},d.crudBinding),null,16)]),_:1})}const B=g(S,[["render",C]]);export{B as default};
