import{$ as m,a0 as f,a3 as c,a1 as R,a7 as i,_,f as b,a4 as P,a5 as N,A as O,r as I,o as v,i as A,w as D,b as k,m as B,a6 as C}from"./index-C2nmCatd.js";import{v as l}from"./validation-D2voD8Jn.js";function $({crudOptions:s}){return{crudOptions:{request:{transformQuery:({page:e,form:t,sort:r})=>{const u=r==null?{}:{orderProp:r.prop,orderAsc:r.asc};return{pageNum:e.currentPage,pageSize:e.pageSize,orderItemsBo:{...t},...u}},transformRes:({res:e})=>({total:e.total,records:e.rows}),pageRequest:async e=>await f("/orderItems/listPages",e),addRequest:async({form:e})=>await c("/orderItems/addOrUpdate",e),editRequest:async({form:e,row:t})=>{e.orderItemId=t.orderItemId,await c("/orderItems/addOrUpdate",e);const r={productId:e.productId,stockQuantity:-e.quantity-t.quantity};return await f("/products/update",r)},delRequest:async({row:e})=>{await R("/orderItems/delete",{id:e.orderItemId});const t={productId:e.productId,orderId:e.orderId,quantity:e.quantity};return await c("/returns/addOrUpdate",t)}},pagination:{pageSize:10,pageNum:1},actionbar:{buttons:{add:{show:!1}}},form:{watch({form:e}){e.totalPrice=e.quantity*e.unitPrice}},rowHandle:{width:125,buttons:{remove:{show:!1}}},columns:{orderItemId:{column:{show:!1},title:"明细ID",key:"order_item_id",type:"number",form:{show:!1},viewForm:{show:!0}},orderId:{column:{minWidth:45,align:"center"},title:"部门名称",type:"dict-select",search:{show:!0},form:{},editForm:{component:{disabled:!0}},dict:m({value:"orderId",label:"customerName",getData:async e=>{try{const[t,r]=await Promise.all([i("/orders/list"),i("/customers/list")]),u=Array.isArray(t.data)?t.data:[],g=Array.isArray(r.data)?r.data:[],h=new Map(g.map(a=>[a.customerId,a.customerName]));return u.map(a=>{const w=h.get(a.customerId)||"未知客户";return{orderId:a.orderId,customerName:w}})}catch(t){return console.error("获取字典数据失败:",t),[]}}})},productId:{column:{minWidth:45,align:"center"},title:"资产名称",type:"dict-select",search:{show:!0},form:{rules:l.required},dict:m({value:"productId",label:"productName",url:"/products/list",getData:async e=>{try{return(await i(e.url)).data}catch(t){return console.error("获取字典数据失败:",t),[]}}})},quantity:{title:"数量",type:"number",form:{rules:l.required}},unitPrice:{title:"单价",type:"number",form:{rules:l.required}},totalPrice:{title:"总价",type:"number",form:{readonly:!0}}}}}}const x=b({name:"OrderItemsCrud",setup(){const{crudRef:s,crudBinding:d,crudExpose:o}=P({createCrudOptions:$}),n=C();return N(n,()=>{o.doRefresh()}),O(()=>{o.doRefresh()}),{crudBinding:d,crudRef:s}}});function z(s,d,o,n,y,q){const p=I("fs-crud"),e=I("fs-page");return v(),A(e,null,{default:D(()=>[k(p,B({ref:"crudRef"},s.crudBinding),null,16)]),_:1})}const U=_(x,[["render",z]]);export{U as default};
