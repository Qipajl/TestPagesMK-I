import{a7 as l,$ as p,a0 as i,a1 as q,a3 as h,_ as v,f as R,a4 as I,A as _,r as y,o as T,i as D,w as b,b as k,m as C}from"./index-C2nmCatd.js";import{v as o}from"./validation-D2voD8Jn.js";function $({crudOptions:n}){return{crudOptions:{request:{transformQuery:({page:t,form:e,sort:r})=>{const a=r==null?{}:{orderProp:r.prop,orderAsc:r.asc};return{pageNum:t.currentPage,pageSize:t.pageSize,inventoryTransactionsBo:{...e},...a}},transformRes:({res:t})=>({total:t.total,records:t.rows}),pageRequest:async t=>await i("/inventoryTransactions/listPages",t),addRequest:async({form:t})=>{await h("/inventoryTransactions/add",t);let e;if(t.transactionType==="入库")e=t.quantity;else if(t.transactionType==="出库")e=-t.quantity;else throw new Error(`无效的交易类型: ${t.transactionType}`);const r={productId:t.productId,stockQuantity:e};return await i("/products/update",r)},editRequest:async({form:t,row:e})=>(t.transactionId=e.transactionId,await i("/inventoryTransactions/addOrUpdate",t)),delRequest:async({row:t})=>await q("/inventoryTransactions/delete",{id:t.transactionId})},pagination:{pageSize:10,pageNum:1},columns:{transactionId:{column:{show:!1},title:"记录ID",key:"transaction_id",type:"number",form:{show:!1},viewForm:{show:!0}},productId:{column:{align:"center"},title:"资产名称",type:"dict-select",search:{show:!0},form:{rules:o.required,component:{on:{onChange:async({value:t,row:e,form:r})=>{if(r){console.log("选择的 productId:",r.productId);try{const a=await l("/products/list");console.log("获取到的产品列表:",a.data);const u=a.data.find(w=>w.productId===r.productId);console.log("component",u),u&&(r.quantity=u.stockQuantity)}catch(a){console.error("获取商品数量失败:",a)}}}}}},dict:p({value:"productId",label:"productName",url:"/products/list",getData:async t=>{try{return(await l(t.url)).data}catch(e){return console.error("获取字典数据失败:",e),[]}}})},transactionType:{title:"交易类型",type:"dict-select",dict:p({data:[{value:"买入",label:"买入"},{value:"变卖",label:"变卖"}]}),form:{value:"买入",show:!0,rules:o.required},search:{show:!0}},quantity:{title:"数量",type:"number",form:{rules:o.required}},transactionDate:{title:"交易日期",type:"date",search:{title:"时间",show:!0,component:{type:"datetimerange"}},form:{show:!0,value:new Date().toISOString(),component:{valueFormat:"YYYY-MM-DD"},rules:o.required}},notes:{title:"备注",type:"textarea"}}}}}const x=R({name:"InventoryTransactionCrud",setup(){const{crudRef:n,crudBinding:s,crudExpose:c}=I({createCrudOptions:$});return _(()=>{c.doRefresh()}),{crudBinding:s,crudRef:n}}});function B(n,s,c,m,f,g){const d=y("fs-crud"),t=y("fs-page");return T(),D(t,null,{default:b(()=>[k(d,C({ref:"crudRef"},n.crudBinding),null,16)]),_:1})}const N=v(x,[["render",B]]);export{N as default};
